# devtool
Code development template

graph TD;
    subgraph 前端展示层
        A1[cnsc小程序]
        A11[A1 用户浏览商品] --> A12[A1 选择商品加入购物车] --> A13[A1 提交订单] -->|订单信息| B[OMS]
        A13 -->|支付请求| P[支付系统]
        A2[佐梦商城]
        A21[A2 用户浏览商品] --> A22[A2 选择商品加入购物车] --> A23[A2 提交订单] -->|订单信息| B
        A23 -->|支付请求| P
        A3[航旅商城]
        A31[A3 用户浏览商品] --> A32[A3 选择商品加入购物车] --> A33[A3 提交订单] -->|订单信息| B
        A33 -->|支付请求| P
        A4[跨境商城]
        A41[A4 用户浏览商品] --> A42[A4 选择商品加入购物车] --> A43[A4 提交订单] -->|订单信息| B
        A43 -->|支付请求| P
        A43 -->|报关相关信息| C[报关推单系统]
        A5[第三方分销商城]
        A51[A5 用户浏览商品] --> A52[A5 选择商品加入购物车] --> A53[A5 提交订单] -->|订单信息| B
        A53 -->|支付请求| P
    end;

    subgraph 支付及验证支付流程
        P -->|发起支付| W[支付网关（对接多种支付渠道）]
        W -->|支付处理| W1[支付结果]
        W1 -->|支付成功| B
        W1 -->|支付失败| A13
        B -->|验证支付信息| B6[验证结果]
        B6 -->|支付验证失败| A13
        B6 -->|支付验证成功| B7[标记订单已支付]
    end;

    subgraph 中间业务处理层
        B7 -->|订单验证（检查订单完整性、用户信息等）| B1[验证结果]
        B1 -->|验证通过| B2[订单分类（普通/跨境等）]
        B2 -->|普通订单| B3[订单拆分（按商品仓库）] --> B4[订单合并（同一用户多个订单）] --> B5[订单调度（确定物流等）] -->|订单处理信息| D[ERP]
        B2 -->|跨境订单| B3 --> B4 --> B5 --> C
        C -->|报关信息审核| C1[审核结果]
        C1 -->|审核通过| C2[向海关推送报关信息] --> C3[等待报关结果]
        C3 -->|报关成功| B5
        B -->|根据库存情况更新商品可售状态等| E[WMS]
    end;

    subgraph 订单处理及发货流程
        D -->|财务核算（计算订单收入、成本等）| D1[财务数据更新]
        E -->|出库操作（根据订单找货、发货）| E1[更新库存数据（减少库存）] --> B
        E1 -->|库存不足通知| B
        E -->|接收采购指令（来自 ERP）| E2[入库准备] --> E3[商品入库] --> E4[更新库存数据（增加库存）] --> D
    end;

    subgraph 售后流程（退换货）
        R[售后申请入口（前端商城）] -->|售后申请（退换货等）| B8[售后处理系统]
        B8 -->|审核售后申请| B9[审核结果]
        B9 -->|审核通过（退货）| B10[生成退货单] --> E5[接收退货入库] --> E6[更新库存数据（增加库存）] --> D
        B9 -->|审核通过（换货）| B10 --> B11[生成换货单] --> B3
        B9 -->|审核不通过| R
    end;

    subgraph 商品流程
        G[商品信息管理系统] -->|推送商品信息| A1
        G -->|推送商品信息| A2
        G -->|推送商品信息| A3
        G -->|推送商品信息| A4
        G -->|推送商品信息| A5
        F2 -->|更新商品采购信息| G
        E3 -->|更新库存商品信息| G
    end;

    subgraph 采购流程
        D -->|生成采购需求（根据订单及库存）| D2[采购需求信息] --> F[采购系统]
        F -->|采购计划制定（根据需求、供应商等）| F1[采购计划] --> F2[采购执行（与供应商对接、签订合同等）] --> F3[采购反馈（到货时间、数量等）] --> D
    end;
